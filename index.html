async function searchKeyword(kw) {
  const now = new Date();
  // ה-Prompt המעודכן עבור Gemini
  const prompt = `Search X (Twitter) for the very latest posts about: "${kw.terms}". 
  ONLY posts from the LAST 2 MINUTES.
  Return JSON only: {"posts":[{"text":"tweet text","author":"@handle","time":"1m ago","url":"link"}]}`;

  try {
    // אנחנו פונים לפונקציית השרת שיצרנו ב-Vercel
    const r = await fetch("/api/search", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ prompt: prompt })
    });

    if (!r.ok) throw new Error(`API ${r.status}`);
    
    const data = await r.json();
    
    // שליפת הטקסט שהחזיר Gemini
    const aiText = data.candidates[0].content.parts[0].text;
    
    // ניקוי הטקסט כדי למצוא את ה-JSON בתוכו
    const jsonMatch = aiText.match(/\{[\s\S]*\}/);
    let posts = [];
    if (jsonMatch) {
      posts = JSON.parse(jsonMatch[0]).posts || [];
    }

    if (posts.length === 0) return { posts: [], translated: [] };

    // קריאה לפונקציית התרגום (שגם אותה נעדכן ל-Gemini)
    const translated = await translatePosts(posts);
    return { posts, translated };
    
  } catch (err) {
    console.error('Search error:', err);
    S.errors.push({ time: new Date().toISOString(), msg: err.message });
    return { posts: [], translated: [], error: err.message };
  }
}
