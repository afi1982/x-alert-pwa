<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#ff2d4a">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="X Alert">
<link rel="manifest" href="/manifest.json">
<link rel="apple-touch-icon" href="/icon-192.png">
<title>X Live Alert</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Noto+Sans+Hebrew:wght@300;400;600;700;900&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#06060c; --bg2:#0e0e1a; --card:#111122; --card2:#161630;
  --accent:#00e5ff; --accentD:#00e5ff22;
  --red:#ff2d4a; --redD:#ff2d4a18; --redG:#ff2d4a44;
  --green:#00e676; --greenD:#00e67622;
  --warn:#ffb800;
  --text:#eaeaf4; --text2:#7777aa; --text3:#444466;
  --brd:#1e1e38; --r:14px;
  --fh:'Noto Sans Hebrew',sans-serif; --fm:'Space Mono',monospace;
}
*{margin:0;padding:0;box-sizing:border-box}
html{height:100%}
body{background:var(--bg);color:var(--text);font-family:var(--fh);min-height:100%;-webkit-tap-highlight-color:transparent;padding-bottom:env(safe-area-inset-bottom)}
body::before{content:'';position:fixed;inset:0;background:radial-gradient(ellipse at 20% 0%,#00e5ff06 0%,transparent 50%),radial-gradient(ellipse at 80% 100%,#ff2d4a04 0%,transparent 50%);pointer-events:none}
.app{position:relative;z-index:1;max-width:800px;margin:0 auto;padding:14px;padding-top:max(14px,env(safe-area-inset-top))}

/* Install banner */
.install-banner{background:linear-gradient(135deg,var(--red),#ff6b35);color:#fff;padding:14px 18px;border-radius:var(--r);margin-bottom:14px;display:flex;align-items:center;justify-content:space-between;font-size:13px;font-weight:600;animation:slideD .4s}
.install-banner button{background:#fff;color:var(--red);border:none;padding:8px 18px;border-radius:8px;font-weight:700;cursor:pointer;font-family:var(--fh);font-size:12px}
.install-banner .close-btn{background:transparent;color:rgba(255,255,255,.7);padding:4px 8px;font-size:18px}
@keyframes slideD{from{opacity:0;transform:translateY(-15px)}to{opacity:1;transform:translateY(0)}}

/* Notif banner */
.notif-banner{background:var(--card);border:1px solid var(--warn);padding:12px 16px;border-radius:var(--r);margin-bottom:14px;display:flex;align-items:center;justify-content:space-between;font-size:12px;color:var(--warn)}
.notif-banner button{background:var(--warn);color:#000;border:none;padding:7px 16px;border-radius:8px;font-weight:700;cursor:pointer;font-family:var(--fh);font-size:12px}

.header{display:flex;align-items:center;justify-content:space-between;padding:16px 0;margin-bottom:14px;border-bottom:1px solid var(--brd)}
.logo{display:flex;align-items:center;gap:11px}
.logo-icon{width:40px;height:40px;background:linear-gradient(135deg,var(--red),#ff6b35);border-radius:11px;display:flex;align-items:center;justify-content:center;font-size:18px;color:#fff;box-shadow:0 0 18px var(--redD)}
.logo h1{font-size:18px;font-weight:900}
.logo p{font-size:10px;color:var(--text2);font-weight:300;margin-top:1px}
.hctrl{display:flex;gap:6px;align-items:center}
.pill{display:flex;align-items:center;gap:6px;padding:5px 11px;background:var(--card);border:1px solid var(--brd);border-radius:100px;font-size:11px;color:var(--text2);font-family:var(--fm)}
.dot{width:6px;height:6px;border-radius:50%;background:var(--text3)}
.dot.on{background:var(--green);box-shadow:0 0 6px var(--green);animation:bl 2s infinite}
@keyframes bl{0%,100%{opacity:1}50%{opacity:.4}}
.bs{padding:5px 10px;background:var(--card);border:1px solid var(--brd);border-radius:7px;color:var(--text2);font-size:12px;cursor:pointer;font-family:var(--fh);transition:all .2s}
.bs:hover{border-color:var(--accentD);color:var(--text)}

.add{background:var(--card);border:1px solid var(--brd);border-radius:var(--r);padding:16px;margin-bottom:14px}
.add h2{font-size:13px;font-weight:700;margin-bottom:10px}
.fr{display:flex;gap:8px}
.fi{flex:1;padding:10px 13px;background:var(--bg);border:2px solid var(--brd);border-radius:9px;color:var(--text);font-family:var(--fh);font-size:14px;outline:none;transition:all .3s}
.fi:focus{border-color:var(--accent);box-shadow:0 0 10px var(--accentD)}
.fi::placeholder{color:var(--text3)}
.fs{padding:10px 10px;background:var(--bg);border:2px solid var(--brd);border-radius:9px;color:var(--accent);font-family:var(--fm);font-size:11px;outline:none;cursor:pointer;min-width:90px}
.fs option{background:var(--card);color:var(--text)}
.bgo{padding:10px 18px;background:linear-gradient(135deg,var(--red),#ff6b35);color:#fff;border:none;border-radius:9px;font-weight:700;font-size:13px;cursor:pointer;font-family:var(--fh);white-space:nowrap;transition:all .2s}
.bgo:hover{transform:translateY(-1px);box-shadow:0 4px 15px var(--redD)}
.bgo:active{transform:scale(.97)}

.chips{display:flex;flex-wrap:wrap;gap:7px;margin-bottom:14px}
.chip{display:flex;align-items:center;gap:6px;padding:6px 12px;background:var(--card);border:1px solid var(--brd);border-radius:100px;font-size:11px;font-weight:600;animation:ci .3s}
.chip.on{border-color:var(--green);background:var(--greenD)}
.chip.srch{border-color:var(--accent);background:var(--accentD)}
@keyframes ci{from{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}
.cd{width:5px;height:5px;border-radius:50%;background:var(--text3);flex-shrink:0}
.cd.on{background:var(--green);box-shadow:0 0 4px var(--green);animation:bl 1.5s infinite}
.cd.sr{background:var(--accent);animation:bl .5s infinite}
.cm{font-family:var(--fm);font-size:9px;color:var(--text3);font-weight:400}
.cr{width:15px;height:15px;border-radius:50%;border:none;background:transparent;color:var(--text3);cursor:pointer;font-size:10px;display:flex;align-items:center;justify-content:center}
.cr:hover{background:var(--redD);color:var(--red)}

.fh{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
.fh h2{font-size:13px;font-weight:700}
.fc{font-family:var(--fm);font-size:10px;color:var(--text3);background:var(--card);padding:2px 8px;border-radius:100px;border:1px solid var(--brd)}

.ac{background:var(--card);border:1px solid var(--brd);border-radius:var(--r);padding:14px 15px;margin-bottom:8px;animation:as .4s;position:relative;overflow:hidden}
.ac::before{content:'';position:absolute;top:0;right:0;width:3px;height:100%;background:linear-gradient(180deg,var(--red),var(--redD))}
.ac.fl{border-color:var(--red);box-shadow:0 0 20px var(--redD)}
.ac.fl::after{content:'×—×“×©!';position:absolute;top:7px;left:7px;background:var(--red);color:#fff;font-size:9px;font-weight:700;padding:2px 6px;border-radius:3px;animation:fb 1s ease-in-out 3}
@keyframes fb{0%,100%{opacity:1}50%{opacity:.3}}
@keyframes as{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}

.at{display:flex;align-items:center;justify-content:space-between;margin-bottom:7px;flex-wrap:wrap;gap:4px}
.ab{display:inline-flex;align-items:center;gap:3px;background:var(--redD);color:var(--red);font-size:10px;font-weight:700;padding:2px 8px;border-radius:4px}
.atm{font-family:var(--fm);font-size:9px;color:var(--text3)}
.apt{font-family:var(--fm);font-size:10px;color:var(--accent);margin-right:5px}
.aau{font-size:11px;color:var(--text2);margin-bottom:4px;font-weight:600}
.atx{font-size:13px;color:var(--text);line-height:1.7}
.atx mark{background:var(--redD);color:var(--red);padding:1px 2px;border-radius:2px}
.af{margin-top:7px}
.al{font-size:10px;color:var(--accent);text-decoration:none;font-family:var(--fm)}
.al:hover{text-decoration:underline}

.empty{text-align:center;padding:40px 16px;color:var(--text3)}
.empty-i{font-size:32px;margin-bottom:8px;opacity:.4}
.empty p{font-size:12px;line-height:1.8}

.popup{position:fixed;top:max(12px,env(safe-area-inset-top));left:50%;transform:translateX(-50%);background:linear-gradient(135deg,#1a1028,#12001f);border:2px solid var(--red);border-radius:14px;padding:13px 18px;z-index:9999;max-width:92vw;width:380px;box-shadow:0 8px 35px rgba(255,45,74,.35);animation:pi .4s;font-family:var(--fh);direction:rtl}
@keyframes pi{from{opacity:0;transform:translateX(-50%) translateY(-15px) scale(.95)}to{opacity:1;transform:translateX(-50%) translateY(0) scale(1)}}
.popup .pt{display:flex;align-items:center;gap:7px;margin-bottom:4px}
.popup .pt span{font-size:18px}
.popup .pt strong{color:var(--red);font-size:12px}
.popup .pb{color:#bbb;font-size:11px;line-height:1.5}

.lb{height:2px;background:var(--bg2);border-radius:2px;margin-bottom:14px;overflow:hidden}
.lb.on .lf{animation:sw 2s ease-in-out infinite}
.lf{height:100%;width:30%;background:linear-gradient(90deg,transparent,var(--accent),transparent);border-radius:2px}
@keyframes sw{0%{transform:translateX(-100%)}100%{transform:translateX(400%)}}

.eb{background:#331a1a;border:1px solid #552222;border-radius:9px;padding:10px 14px;margin-bottom:10px;font-size:11px;color:#ff8888;display:flex;align-items:center;gap:7px;animation:as .3s}

.info{background:var(--card);border:1px solid var(--brd);border-radius:var(--r);padding:14px;margin-top:16px;font-size:11px;color:var(--text2);line-height:1.8}
.info h3{font-size:11px;color:var(--text);margin-bottom:4px}

@media(max-width:640px){.fr{flex-direction:column}.header{flex-direction:column;gap:8px}.hctrl{width:100%;justify-content:space-between}}
</style>
</head>
<body>
<div class="app" id="app"></div>
<script>
// ============================================
// X LIVE ALERT - PWA with Push Notifications
// ============================================

let swReg = null;
let deferredInstallPrompt = null;
let showInstallBanner = false;
let notifPermission = 'default';

// Register Service Worker
async function registerSW() {
  if ('serviceWorker' in navigator) {
    try {
      swReg = await navigator.serviceWorker.register('/sw.js');
      console.log('SW registered');
    } catch(e) {
      console.log('SW registration failed:', e);
    }
  }
}
registerSW();

// Listen for install prompt
window.addEventListener('beforeinstallprompt', e => {
  e.preventDefault();
  deferredInstallPrompt = e;
  showInstallBanner = true;
  render();
});

// Check notification permission
if (typeof Notification !== 'undefined') {
  notifPermission = Notification.permission;
}

async function requestNotifPermission() {
  if (typeof Notification === 'undefined') return;
  notifPermission = await Notification.requestPermission();
  render();
}

async function installApp() {
  if (!deferredInstallPrompt) return;
  deferredInstallPrompt.prompt();
  const result = await deferredInstallPrompt.userChoice;
  if (result.outcome === 'accepted') {
    showInstallBanner = false;
    deferredInstallPrompt = null;
  }
  render();
}

// State
const S = {
  keywords: [],
  alerts: [],
  soundOn: true,
  intervals: {},
  seen: new Set(),
  errors: []
};

function uid(){return Date.now().toString(36)+Math.random().toString(36).slice(2,6)}
function hash(t){let h=0;const s=t.replace(/\s+/g,'').toLowerCase().slice(0,120);for(let i=0;i<s.length;i++){h=((h<<5)-h)+s.charCodeAt(i);h=h&h}return h.toString(36)}

function playSound(){
  if(!S.soundOn)return;
  try{
    const c=new(window.AudioContext||window.webkitAudioContext)(),o=c.createOscillator(),g=c.createGain();
    o.connect(g);g.connect(c.destination);o.type='sine';
    o.frequency.setValueAtTime(660,c.currentTime);o.frequency.setValueAtTime(880,c.currentTime+.08);o.frequency.setValueAtTime(1100,c.currentTime+.16);
    g.gain.setValueAtTime(.2,c.currentTime);g.gain.exponentialRampToValueAtTime(.01,c.currentTime+.4);
    o.start(c.currentTime);o.stop(c.currentTime+.4);
  }catch(e){}
}

// Send notification via Service Worker (works even in background!)
function sendPushNotif(title, body, url) {
  if (swReg && notifPermission === 'granted') {
    swReg.active?.postMessage({
      type: 'SHOW_NOTIFICATION',
      title, body, url
    });
  }
}

function showPopup(title, body) {
  // Push via SW for phone notifications
  sendPushNotif(title, body, '/');
  
  // Also in-app popup
  const el=document.createElement('div');el.className='popup';
  el.innerHTML=`<div class="pt"><span>ğŸš¨</span><strong>${title}</strong></div><div class="pb">${body}</div>`;
  document.body.appendChild(el);
  setTimeout(()=>{el.style.transition='opacity .5s,transform .5s';el.style.opacity='0';el.style.transform='translateX(-50%) translateY(-12px)';setTimeout(()=>el.remove(),500)},5000);
  playSound();
}

// ============================================
// SEARCH via Claude API + Web Search
// ============================================
async function searchKeyword(kw) {
  const now = new Date();
  const prompt = `Search X (Twitter) for the very latest posts about: "${kw.terms}"

CRITICAL - TIME FILTER:
- ONLY posts from the LAST 2 MINUTES
- If a post says "1m", "2m", "just now", "seconds ago" - INCLUDE it
- If a post says "3m", "5m", "1h", "2h" or older - DO NOT include it
- I need REAL TIME monitoring, only the freshest posts

For each qualifying tweet return JSON only:
{"posts":[{"text":"exact tweet text","author":"@handle","time":"e.g. 1m ago","url":"tweet url if available"}],"found":true}

If nothing in last 2 min: {"posts":[],"found":false}
Current time: ${now.toISOString()}`;

  try {
    const r = await fetch("https://api.anthropic.com/v1/messages", {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({
        model:"claude-sonnet-4-20250514",
        max_tokens:2000,
        tools:[{"type":"web_search_20250305","name":"web_search"}],
        messages:[{role:"user",content:prompt}]
      })
    });

    if(!r.ok) throw new Error(`API ${r.status}`);
    const data=await r.json();
    let text='';
    if(data.content) for(const b of data.content) if(b.type==='text') text+=b.text;

    const jm=text.match(/\{[\s\S]*\}/);
    let posts=[];
    if(jm){try{posts=JSON.parse(jm[0]).posts||[]}catch(e){posts=extractFB(text,kw.terms)}}
    else posts=extractFB(text,kw.terms);

    if(posts.length===0) return {posts:[],translated:[]};

    const translated=await translatePosts(posts);
    return {posts,translated};
  }catch(err){
    console.error('Search error:',err);
    S.errors.push({time:new Date().toISOString(),msg:err.message});
    if(S.errors.length>5)S.errors.shift();
    return {posts:[],translated:[],error:err.message};
  }
}

async function translatePosts(posts){
  if(!posts.length) return [];
  const txt=posts.map((p,i)=>`[${i+1}] ${p.text}`).join('\n');
  try{
    const r=await fetch("https://api.anthropic.com/v1/messages",{
      method:"POST",headers:{"Content-Type":"application/json"},
      body:JSON.stringify({
        model:"claude-sonnet-4-20250514",max_tokens:2000,
        messages:[{role:"user",content:`Translate these X/Twitter posts to Hebrew. Keep @usernames as-is.\nCheck if each post is from the last 2 minutes (1m, 2m, just now = recent. 3m+ = not recent).\n\n${txt}\n\nReturn ONLY JSON:\n{"translations":[{"index":1,"hebrew":"translated text","isRecent":true}]}`}]
      })
    });
    if(!r.ok) throw new Error('translate err');
    const data=await r.json();
    let t='';for(const b of data.content)if(b.type==='text')t+=b.text;
    const jm=t.match(/\{[\s\S]*\}/);
    if(jm) return JSON.parse(jm[0]).translations||[];
  }catch(e){console.error('Translate err:',e)}
  return posts.map((p,i)=>({index:i+1,hebrew:p.text,isRecent:true}));
}

function extractFB(text,terms){
  const posts=[],ta=terms.toLowerCase().split(/\s+/);
  for(const l of text.split('\n').filter(l=>l.trim().length>15)){
    const lo=l.toLowerCase();
    if(ta.some(t=>lo.includes(t))&&!lo.includes('"posts"')&&!lo.includes('json'))
      posts.push({text:l.replace(/^[-*â€¢"]\s*/,'').trim(),author:'',time:'',url:''});
  }
  return posts.slice(0,5);
}

// Monitor cycle
async function runCycle(id){
  const kw=S.keywords.find(k=>k.id===id);
  if(!kw||!kw.active) return;
  kw.status='searching';kw.lastCheck=new Date().toISOString();render();

  const res=await searchKeyword(kw);
  if(res.error){kw.status='error';kw.lastResult=res.error;kw.totalChecks=(kw.totalChecks||0)+1;render();return}

  const posts=res.posts||[],trans=res.translated||[];
  let nc=0;

  for(let i=0;i<posts.length;i++){
    const p=posts[i];
    if(!p.text||p.text.length<10) continue;
    const h=hash(p.text);
    if(S.seen.has(h)) continue;
    S.seen.add(h);

    const tr=trans.find(t=>t.index===i+1);
    if(tr&&tr.isRecent===false) continue;

    const ta=kw.terms.toLowerCase().split(/\s+/);
    const ol=p.text.toLowerCase(),hl2=(tr?.hebrew||'').toLowerCase();
    if(!ta.every(t=>ol.includes(t))&&!ta.every(t=>hl2.includes(t))) continue;

    nc++;
    const alert={id:uid(),keywordId:id,keyword:kw.terms,originalText:p.text,text:tr?.hebrew||p.text,author:p.author||'',postTime:p.time||'',url:p.url||'',detectedAt:new Date().toISOString(),isNew:true};
    S.alerts.unshift(alert);
    showPopup(`× ××¦×: "${kw.terms}"`,alert.text.slice(0,100));
    setTimeout(()=>{alert.isNew=false;render()},30000);
  }

  kw.status=nc>0?'found':'idle';
  kw.lastResult=nc>0?`${nc} ×¤×•×¡×˜×™× ×—×“×©×™×!`:'××™×Ÿ ×—×“×©';
  kw.totalChecks=(kw.totalChecks||0)+1;
  if(nc>0) setTimeout(()=>{kw.status='idle';render()},8000);
  if(S.alerts.length>80) S.alerts=S.alerts.slice(0,80);
  if(S.seen.size>400){const a=[...S.seen];S.seen=new Set(a.slice(-250))}
  render();
}

function start(id){
  const kw=S.keywords.find(k=>k.id===id);if(!kw)return;
  stop(id);kw.active=true;
  runCycle(id);
  S.intervals[id]=setInterval(()=>runCycle(id),(kw.interval||60)*1000);
  render();
}

function stop(id){
  if(S.intervals[id]){clearInterval(S.intervals[id]);delete S.intervals[id]}
  const kw=S.keywords.find(k=>k.id===id);
  if(kw){kw.active=false;kw.status='idle'}
  render();
}

function addKW(terms,interval){
  terms=terms.trim();if(!terms)return;
  if(S.keywords.some(k=>k.terms.toLowerCase()===terms.toLowerCase()))return;
  S.keywords.push({id:uid(),terms,interval:parseInt(interval),active:false,status:'idle',lastCheck:null,lastResult:'',totalChecks:0});
  render();start(S.keywords[S.keywords.length-1].id);
}

function removeKW(id){stop(id);S.keywords=S.keywords.filter(k=>k.id!==id);S.alerts=S.alerts.filter(a=>a.keywordId!==id);render()}
function clearAlerts(){S.alerts=[];S.seen.clear();render()}

function ft(iso){if(!iso)return'--';return new Date(iso).toLocaleTimeString('he-IL',{hour:'2-digit',minute:'2-digit',second:'2-digit'})}
function ago(iso){if(!iso)return'';const m=Math.floor((Date.now()-new Date(iso).getTime())/60000);if(m<1)return'×¢×›×©×™×•';if(m<60)return`×œ×¤× ×™ ${m}×“×³`;return`×œ×¤× ×™ ${Math.floor(m/60)}×©×³`}
function hl(text,terms){const ws=terms.toLowerCase().split(/\s+/);let r=text;for(const w of ws){const re=new RegExp(`(${w.replace(/[.*+?^${}()|[\]\\]/g,'\\$&')})`,'gi');r=r.replace(re,'<mark>$1</mark>')}return r}
function il(s){return s<60?s+' ×©× ×™×•×ª':(s/60)+' ×“×§×•×ª'}

// ============================================
// RENDER
// ============================================
function render(){
  const app=document.getElementById('app');
  const ac=S.keywords.filter(k=>k.active).length;
  const sr=S.keywords.some(k=>k.status==='searching');

  app.innerHTML=`
    ${showInstallBanner?`
    <div class="install-banner">
      <span>ğŸ“± ×”×ª×§×Ÿ ××ª ×”××¤×œ×™×§×¦×™×” ×‘×˜×œ×¤×•×Ÿ ×œ×§×‘×œ×ª ×”×ª×¨××•×ª</span>
      <div style="display:flex;gap:6px">
        <button onclick="installApp()">×”×ª×§×Ÿ ×¢×›×©×™×•</button>
        <button class="close-btn" onclick="showInstallBanner=false;render()">âœ•</button>
      </div>
    </div>`:''}

    ${notifPermission!=='granted'?`
    <div class="notif-banner">
      <span>ğŸ”” ××©×¨ ×”×ª×¨××•×ª ×›×“×™ ×œ×§×‘×œ ×¢×“×›×•× ×™× ×’× ×›×©×”××¤×œ×™×§×¦×™×” ×‘×¨×§×¢</span>
      <button onclick="requestNotifPermission()">××©×¨</button>
    </div>`:''}

    <header class="header">
      <div class="logo">
        <div class="logo-icon">âš¡</div>
        <div>
          <h1>X Live Alert</h1>
          <p>×—×“×©×•×ª ×—×™ Â· 2 ×“×§×•×ª ××—×¨×•× ×•×ª Â· ××ª×•×¨×’× ×œ×¢×‘×¨×™×ª</p>
        </div>
      </div>
      <div class="hctrl">
        <button class="bs" onclick="S.soundOn=!S.soundOn;render()">${S.soundOn?'ğŸ”Š':'ğŸ”‡'}</button>
        <div class="pill"><span class="dot ${ac>0?'on':''}"></span>${ac>0?ac+' ×× ×•×˜×¨':'×œ× ×¤×¢×™×œ'}</div>
      </div>
    </header>

    <div class="lb ${sr?'on':''}"><div class="lf"></div></div>

    ${S.errors.length>0?`<div class="eb">âš ï¸ ${S.errors[S.errors.length-1].msg.slice(0,60)} Â· ${ft(S.errors[S.errors.length-1].time)} <button class="bs" onclick="S.errors=[];render()" style="margin-right:auto;font-size:9px;padding:3px 8px">âœ•</button></div>`:''}

    <div class="add">
      <h2>ğŸ” ×”×•×¡×£ × ×™×˜×•×¨</h2>
      <div class="fr">
        <input class="fi" type="text" id="inp" placeholder="××™×œ×•×ª ×—×™×¤×•×©... (×¤×™×¦×•×¥ ××™×¨××Ÿ)" onkeydown="if(event.key==='Enter')document.getElementById('go').click()">
        <select class="fs" id="intv">
          <option value="60" selected>×›×œ ×“×§×”</option>
          <option value="120">×›×œ 2 ×“×§×•×ª</option>
          <option value="300">×›×œ 5 ×“×§×•×ª</option>
        </select>
        <button class="bgo" id="go" onclick="const i=document.getElementById('inp'),s=document.getElementById('intv');addKW(i.value,s.value);i.value='';i.focus()">ğŸš€ ×”×ª×—×œ</button>
      </div>
    </div>

    ${S.keywords.length>0?`<div class="chips">${S.keywords.map(k=>`
      <div class="chip ${k.active?(k.status==='searching'?'srch':'on'):''}">
        <span class="cd ${k.active?(k.status==='searching'?'sr':'on'):''}"></span>
        <span>${k.terms}</span>
        <span class="cm">${il(k.interval)}</span>
        <span class="cm">${k.totalChecks||0}Ã—</span>
        <span class="cm">${k.status==='searching'?'ğŸ”„':k.status==='error'?'âš ï¸':k.status==='found'?'ğŸš¨':'âœ“'}</span>
        <button class="cr" onclick="removeKW('${k.id}')">âœ•</button>
      </div>`).join('')}</div>`:''}

    <div class="fh">
      <h2>ğŸš¨ ×¤×™×“ ×—×™${S.alerts.length>0?` (${S.alerts.length})`:''}</h2>
      ${S.alerts.length>0?`<button class="bs" onclick="clearAlerts()" style="font-size:9px">ğŸ—‘ï¸ × ×§×”</button>`:''}
    </div>

    ${S.alerts.length>0?S.alerts.slice(0,30).map(a=>`
      <div class="ac ${a.isNew?'fl':''}">
        <div class="at">
          <div><span class="ab">ğŸ”‘ ${a.keyword}</span>${a.postTime?`<span class="apt">â± ${a.postTime}</span>`:''}</div>
          <span class="atm">ğŸ”” ${ft(a.detectedAt)} Â· ${ago(a.detectedAt)}</span>
        </div>
        ${a.author?`<div class="aau">${a.author}</div>`:''}
        <div class="atx">${hl(a.text.slice(0,400),a.keyword)}</div>
        ${a.originalText&&a.originalText!==a.text?`<details style="margin-top:5px"><summary style="font-size:10px;color:var(--text3);cursor:pointer">ğŸ“ ××§×•×¨</summary><div style="font-size:11px;color:var(--text3);margin-top:3px;direction:ltr;text-align:left">${a.originalText.slice(0,300)}</div></details>`:''}
        ${a.url?`<div class="af"><a class="al" href="${a.url}" target="_blank">ğŸ”— ×¤×ª×— ×‘X â†</a></div>`:''}
      </div>`).join(''):`
      <div class="empty"><div class="empty-i">ğŸ“¡</div><p>××—×›×” ×œ×”×ª×¨××•×ª...<br>×”×•×¡×£ ××™×œ×•×ª ×—×™×¤×•×© ×›×“×™ ×œ×”×ª×—×™×œ</p></div>`}

    <div class="info">
      <h3>ğŸ“± ××™×š ×œ×”×ª×§×™×Ÿ ×‘×˜×œ×¤×•×Ÿ</h3>
      <p>
        <strong>×× ×“×¨×•××™×“:</strong> ×œ×—×¥ ×¢×œ â‹® (×ª×¤×¨×™×˜) â†’ "×”×•×¡×£ ×œ××¡×š ×”×‘×™×ª" ××• "×”×ª×§×Ÿ ××¤×œ×™×§×¦×™×”"<br>
        <strong>××™×™×¤×•×Ÿ:</strong> ×œ×—×¥ ×¢×œ ×©×™×ª×•×£ â†‘ â†’ "×”×•×¡×£ ×œ××¡×š ×”×‘×™×ª"<br><br>
        âœ… ×”×ª×¨××•×ª push ×‘×˜×œ×¤×•×Ÿ ×’× ×›×©×”××¡×š ×›×‘×•×™<br>
        âœ… ×¨×§ ×¤×•×¡×˜×™× ×-2 ×”×“×§×•×ª ×”××—×¨×•× ×•×ª<br>
        âœ… ×ª×¨×’×•× ××•×˜×•××˜×™ ×œ×¢×‘×¨×™×ª<br>
        âœ… ×¨×˜×˜ + ×¦×œ×™×œ ×‘×›×œ ×”×ª×¨××”
      </p>
    </div>`;
}

render();
</script>
</body>
</html>
