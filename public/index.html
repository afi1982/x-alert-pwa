// בתוך ה-Script של ה-index.html, נעדכן את פונקציית fetchData:

async function fetchData(kw) {
    try {
        const response = await fetch('/api/search', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ keyword: kw })
        });
        
        const items = await response.json();

        items.forEach(item => {
            if (seenPosts.has(item.url)) return; // מניעת כפילויות לפי לינק אמיתי
            seenPosts.add(item.url);
            
            addAlertToUI(kw, item);
            notify(kw, item.title);
        });
    } catch (e) {
        console.error("Fetch error:", e);
    }
}

function addAlertToUI(kw, item) {
    const container = document.getElementById('alertsContainer');
    const card = document.createElement('div');
    card.className = 'alert-card';
    card.innerHTML = `
        <div class="card-header">
            <span class="author">${item.source_name}</span>
            <span class="time">${new Date().toLocaleTimeString('he-IL')}</span>
        </div>
        <div class="content"><strong>${item.title}</strong><br>${item.summary}</div>
        <div class="footer-links">
            <span style="font-size:11px; color:var(--text-secondary)">מילת מפתח: ${kw}</span>
            <a href="${item.url}" target="_blank" class="source-btn">קרא את הכתבה המלאה ←</a>
        </div>
    `;
    container.prepend(card);
}